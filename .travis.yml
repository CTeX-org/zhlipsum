matrix:
  include:
    - name: "TeX Live"
      install:
        - source ./scripts/texlive.sh
      script:
        - source ./scripts/run.sh check-utf8
        - source ./scripts/run.sh check-gbk-big5
      cache:
        directories:
          - /tmp/texlive
          - $HOME/.texlive
    - name: "MikTeX"
      sudo: required
      services:
        - docker
      before_install:
        # - docker build -t miktex:ubuntu-18.04 .
        # - docker volume create --name zhlipsum
        - docker pull miktex/miktex
        - docker volume create --name pkg
      install:
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install adobemapping
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install amsfonts
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install amsmath
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install caption
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install cjk
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install cjkpunct
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install cm
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ctablestack
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ctex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install currfile
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install dvipdfmx
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install environ
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install etex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install etoolbox
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install euenc
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install fancyhdr
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install fandol
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install filehook
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install fontspec
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install graphics
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install graphics-cfg
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install graphics-def
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ifxetex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install kantlipsum
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install knuth-lib
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install l3build
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install l3experimental
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install l3kernel
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install l3packages
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install lm
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install lm-math
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ltxbase
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install lualatex-math
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install lualibs
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install luaotfload
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install luatex85
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install luatexbase
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install luatexja
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install metafont
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install mfware
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install miktex-luatex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install miktex-tex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install miktex-xetex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ms
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install oberdiek
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install preview
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install psnfss
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install tex-ini-files
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install tools
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install trimspaces
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ucharcat
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install ulem
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install unicode-data
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install uplatex
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install varwidth
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install xcjk2uni
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install xcolor
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install xecjk
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install xkeyval
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install xunicode
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install zhmetrics
        - docker run --volume pkg:/miktex/.miktex --volume $(pwd):/miktex/work miktex/miktex mpm --verbose --repository=https://mirrors.rit.edu/CTAN/systems/win32/miktex/tm/packages/ --install zhnumber
      before_script:
        - echo $(pwd)
        - chmod --recursive 777 .
      script:
        # - source ./scripts/run.sh check-utf8 --docker miktex:ubuntu-18.04
        # - source ./scripts/run.sh check-gbk-big5 --docker miktex:ubuntu-18.04
        - source ./scripts/run.sh check-utf8 --docker miktex/miktex
        - source ./scripts/run.sh check-gbk-big5 --docker miktex/miktex

after_failure:
  - cat ./build/test/*.diff
